{% extends "base.html" %}

{% block title %}Competencias | Sistema de Gestión de Empleados{% endblock %}

{% block contenido %}
<div class="container-fluid py-4 px-2 px-md-5 competencias-wrapper-nueva">
    <div class="row mb-4 align-items-center justify-content-between g-3">
        <div class="col-auto d-flex align-items-center gap-3">
            <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo" class="competencias-logo-nueva" onerror="this.style.display='none'">
            <h1 class="fw-bold mb-0 display-6 competencias-titulo-nueva"><i class="fas fa-lightbulb"></i> Competencias de los Empleados</h1>
        </div>
    </div>
    <div class="card shadow-lg border-0 modern-card-nueva animate__animated animate__fadeInUp competencias-card-expandida-nueva">
        <div class="card-body p-4">
            <div class="table-responsive rounded-4 shadow-sm animate__animated animate__fadeInUp animate__delay-1s">
                <table class="table table-striped table-hover modern-table-nueva align-middle mb-0">
                    <thead class="table-light sticky-top">
                        <tr>
                            <th>Nombre</th>
                            <th>Equipo</th>
                            <th>Rol</th>
                            <th>Habilidades</th>
                            <th>Fortalezas</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for emp in empleados %}
                        <tr class="modern-row-nueva">
                            <td>{{ emp.nombre }} {{ emp.apellido }}</td>
                            <td>{{ emp.equipo or 'No asignado' }}</td>
                            <td><span class="badge bg-gradient-info text-white px-3 py-2 shadow-sm">{{ emp.rol|capitalize }}</span></td>
                            <td>
                                {% for h in emp.habilidades %}
                                    <span class="badge bg-gradient-primary text-white px-2 py-1 m-1">{{ h }}</span>
                                {% else %}
                                    <span class="text-muted">Sin habilidades</span>
                                {% endfor %}
                            </td>
                            <td>
                                {% for f in emp.fortalezas %}
                                    <span class="badge bg-gradient-success text-white px-2 py-1 m-1">{{ f }}</span>
                                {% else %}
                                    <span class="text-muted">Sin fortalezas</span>
                                {% endfor %}
                            </td>
                            <td>
                                <button class="btn btn-sm btn-primary modern-btn-action-nueva" data-bs-toggle="modal" data-bs-target="#modalEditar{{ emp.id }}" title="Editar competencias"><i class="fas fa-edit"></i></button>
                            </td>
                        </tr>
                        <!-- Modal de edición de competencias -->
                        <div class="modal fade" id="modalEditar{{ emp.id }}" tabindex="-1" aria-labelledby="modalEditarLabel{{ emp.id }}" aria-hidden="true">
                          <div class="modal-dialog">
                            <div class="modal-content">
                              <form method="POST" action="{{ url_for('editar_competencias', id=emp.id) }}">
                                <div class="modal-header bg-gradient-primary text-white">
                                  <h5 class="modal-title" id="modalEditarLabel{{ emp.id }}">Editar Competencias de {{ emp.nombre }} {{ emp.apellido }}</h5>
                                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                                </div>
                                <div class="modal-body">
                                  <div class="mb-3">
                                    <label for="habilidades{{ emp.id }}" class="form-label">Habilidades</label>
                                    <select class="form-select" id="habilidades{{ emp.id }}" name="habilidades[]" multiple>
                                      {% for h in habilidades_globales %}
                                        <option value="{{ h.id }}" {% if h.nombre in emp.habilidades %}selected{% endif %}>{{ h.nombre }}</option>
                                      {% endfor %}
                                    </select>
                                    <small class="text-muted">Ctrl+Click para seleccionar varias.</small>
                                  </div>
                                  <div class="mb-3">
                                    <label for="fortalezas{{ emp.id }}" class="form-label">Fortalezas</label>
                                    <select class="form-select" id="fortalezas{{ emp.id }}" name="fortalezas[]" multiple>
                                      {% for f in fortalezas_globales %}
                                        <option value="{{ f.id }}" {% if f.nombre in emp.fortalezas %}selected{% endif %}>{{ f.nombre }}</option>
                                      {% endfor %}
                                    </select>
                                    <small class="text-muted">Ctrl+Click para seleccionar varias.</small>
                                  </div>
                                </div>
                                <div class="modal-footer">
                                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                  <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                                </div>
                              </form>
                            </div>
                          </div>
                        </div>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<style>
.competencias-wrapper-nueva {
    min-height: 100vh;
    background: var(--bg, #f4f6fb);
    transition: background 0.4s;
}
.competencias-logo-nueva {
    width: 56px;
    height: 56px;
    border-radius: 14px;
    object-fit: contain;
    box-shadow: 0 2px 8px #5c7cfa22;
    background: #fff;
}
.competencias-titulo-nueva {
    font-size: 2.2rem;
    letter-spacing: 1px;
    color: var(--primary, #23263a);
}
.modern-card-nueva {
    border-radius: 1.7rem !important;
    min-height: 60vh;
    width: 100%;
    max-width: 100vw;
    margin: 0 auto;
    background: #fff;
    transition: background 0.4s;
}
.bg-gradient-primary {
    background: linear-gradient(135deg, #2c3e50, #3498db) !important;
}
.bg-gradient-info {
    background: linear-gradient(135deg, #3498db, #2ecc71) !important;
}
.bg-gradient-success {
    background: linear-gradient(135deg, #2ecc71, #27ae60) !important;
}
.dark-mode .competencias-wrapper-nueva,
.dark-mode .modern-card-nueva {
    background: #23263a !important;
    color: #f1f1f1 !important;
}
.dark-mode .competencias-titulo-nueva {
    color: #f1f1f1 !important;
}
.dark-mode .table-light {
    background: #23263a !important;
    color: #f1f1f1 !important;
}
.dark-mode .modern-table-nueva, .dark-mode .modern-table-nueva th, .dark-mode .modern-table-nueva td {
    background: #23263a !important;
    color: #f1f1f1 !important;
}
.dark-mode .badge.bg-gradient-info { background: linear-gradient(135deg, #3498db, #2ecc71) !important; color: #fff !important; }
.dark-mode .badge.bg-gradient-primary { background: linear-gradient(135deg, #2c3e50, #3498db) !important; color: #fff !important; }
.dark-mode .badge.bg-gradient-success { background: linear-gradient(135deg, #2ecc71, #27ae60) !important; color: #fff !important; }
.badge {
    padding: 0.45em 1em;
    font-weight: 600;
    font-size: 0.98em;
    border-radius: 1.2em;
    box-shadow: 0 1px 4px #23263a11;
    letter-spacing: 0.5px;
}
.modern-table-nueva tbody tr.modern-row-nueva {
    transition: background 0.18s, box-shadow 0.18s;
    cursor: pointer;
}
.modern-table-nueva tbody tr.modern-row-nueva:hover {
    background: #f4f6fb !important;
    box-shadow: 0 2px 12px #5c7cfa11;
}
.modern-btn-action-nueva {
    border-radius: 1.2em;
    box-shadow: 0 1px 4px #23263a11;
    transition: box-shadow 0.2s, transform 0.18s;
}
.modern-btn-action-nueva:hover {
    box-shadow: 0 4px 16px #fa525244, 0 0 8px #fa525288;
    transform: scale(1.12);
}
.table thead th {
    position: sticky;
    top: 0;
    z-index: 2;
    background: #f8f9fa;
}
@media (max-width: 900px) {
    .competencias-logo-nueva { width: 36px; height: 36px; }
    .competencias-titulo-nueva { font-size: 1.3rem; }
}
@media (max-width: 600px) {
    .competencias-logo-nueva { width: 28px; height: 28px; }
    .competencias-titulo-nueva { font-size: 1.1rem; }
    .competencias-wrapper-nueva { padding: 0.5rem !important; }
}
</style>
{% endblock %} 